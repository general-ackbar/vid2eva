
About the EVA5 Format (temporary edition)
=========================================

Following is a simple introduction to EVA5 format, used in EVA Ver.2.


1. Introduction

   EVA5 implements the audio data as a new feature.

   The image data block follows the same format as EVA4.  The audio 
   data block uses unsigned 4 bit or 8 bit PCM format.  The sampling 
   frequency of PCM is variable and should be specified in the header.


2. Data Structure

   EVA5 data consist of the Header block plus the Data block multiplied 
   by the number of the frames.

(1) Header block

         length
         (Bytes)    Content             Remark
------------------------------------------------------------------
code      4         Identifier          "EVA5"
comment   1 to any  comments            Ends with 0x1A
flames    2         the number of frames
width     2         Width in dots       Fixed at 96 for this version
hight     2         Height in dots      Fixed at 92 for this version
color     1         bits per pixel      Fixed at 2 for this version
hwrate    1         aspect ratio        Width/height*0x10.  Fixed at
                                        0x18 (x1.5) for this version
pcmfmt    1         PCM format          0x00 for 8 bit PCM,
                                        0x01 for 4 bit PCM
pcmfrq    2         Sampling Frequency
pcmlen    2         PCM data length     (*1)
                    (bytes per frame)
dummy     1         reserved            0x00
------------------------------------------------------------------

  (*1) The field "Frames per second" in EVA4 is no more used.  It is
       calculated from the sampling frequency and the PCM Data length
       (bytes per frame)


(2) Data block (repeated by the number of frames)

         length(Byte)   Contents
------------------------------------------------------------------
pcmdat   pcmlen         PCM Data
flen       2            The length of the image data which follow
fdata    flen           The image data
------------------------------------------------------------------


o Structure of the image data

  The image data is a combination of the first byte of a 2-bit flag and
  6-bit length information (6 bits or 3 bits + 3 bits) and the
  following data bytes.

             The 1st byte    Following Data (the 2nd byte and after)
------------------------------------------------------------------
Pattern 00   00aaabbb        length bbb of uncompressed data

Pattern 01   01aaaaaa        No Data

Pattern 10   10bbbbbb        Length bbbbbb of uncompressed data

Pattern 11   11aaaccc        No Data
------------------------------------------------------------------

aaa, aaaaaa ... The length of the data with no change (the same as
                the previous frame).  This length should be skipped
                while expanding the data.

bbb, bbbbbb ... The length of the uncompressed data.  Simply copy this
                length of the data to the buffer.

ccc         ... Repetition of the same data. The previous byte in the
                buffer should be copied to length of ccc.


Please refer to the attached sample expand.c for the method how to
expand the data.



3. Limitation

   EVA ver.2 uses PWM to play back the PCM audio data with the beep
   sound.  A FIFO buffer used for the modulation process has a fixed
   length of 16 KB.  If you playback too slowly, it will cause overflow
   in this buffer.  Please use 2 frames per second or higher.


4. Request

   I would be very happy if someone makes converter from the other 
   popular image data format.  I am making the data for EVA by using 
   the X68000 but have a difficulty to distribute them.  I hope the 
   program of EVA will be utilized more often, if the various data of 
   yours can be converted to its format.

   I do hope my short explanation above will meet your needs. If you
   have any questions, please feel free to contact me at the following
   address.

                                          HCA02131@niftyserve.or.jp
                                          Tetsushi Yamamoto (Digiyama)


                                    [  Translated from Japanese by:  ]
                                    [  Toshiki Sasabe (Janbe)        ]
                                    [  73560.524@compuserve.com      ]
